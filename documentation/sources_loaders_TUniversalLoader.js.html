<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>sources/loaders/TUniversalLoader.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="MeshManager.html">MeshManager</a></li><li><a href="TApplication.html">TApplication</a><ul class='methods'><li data-type='method'><a href="TApplication.html#.removeDiacritics">removeDiacritics</a></li><li data-type='method'><a href="TApplication.html#askUserForPosition">askUserForPosition</a></li><li data-type='method'><a href="TApplication.html#changeMaterialSide">changeMaterialSide</a></li><li data-type='method'><a href="TApplication.html#endMeasure">endMeasure</a></li><li data-type='method'><a href="TApplication.html#initRequest">initRequest</a></li><li data-type='method'><a href="TApplication.html#insertTreeViewItem">insertTreeViewItem</a></li><li data-type='method'><a href="TApplication.html#loadObjectFromURL">loadObjectFromURL</a></li><li data-type='method'><a href="TApplication.html#popupImageShotModal">popupImageShotModal</a></li><li data-type='method'><a href="TApplication.html#popupImportFilesModal">popupImportFilesModal</a></li><li data-type='method'><a href="TApplication.html#popupSelectedObjectModal">popupSelectedObjectModal</a></li><li data-type='method'><a href="TApplication.html#removeMeasure">removeMeasure</a></li><li data-type='method'><a href="TApplication.html#removeTemporaryMeasure">removeTemporaryMeasure</a></li><li data-type='method'><a href="TApplication.html#resetDataPanel">resetDataPanel</a></li><li data-type='method'><a href="TApplication.html#setCameraMode">setCameraMode</a></li><li data-type='method'><a href="TApplication.html#setLayerGroupVisibility">setLayerGroupVisibility</a></li><li data-type='method'><a href="TApplication.html#setMapViewer">setMapViewer</a></li><li data-type='method'><a href="TApplication.html#setRendersEffect">setRendersEffect</a></li><li data-type='method'><a href="TApplication.html#startMeasure">startMeasure</a></li><li data-type='method'><a href="TApplication.html#updateAvatar">updateAvatar</a></li><li data-type='method'><a href="TApplication.html#updateDataPanel">updateDataPanel</a></li><li data-type='method'><a href="TApplication.html#updateImageShot">updateImageShot</a></li><li data-type='method'><a href="TApplication.html#updateMapViewer">updateMapViewer</a></li><li data-type='method'><a href="TApplication.html#updateMapViewerOrientation">updateMapViewerOrientation</a></li><li data-type='method'><a href="TApplication.html#updateMapViewerPosition">updateMapViewerPosition</a></li><li data-type='method'><a href="TApplication.html#updateMeasure">updateMeasure</a></li><li data-type='method'><a href="TApplication.html#updateMeshResolution">updateMeshResolution</a></li><li data-type='method'><a href="TApplication.html#updatePointCloudDensity">updatePointCloudDensity</a></li><li data-type='method'><a href="TApplication.html#updateTemporaryMeasure">updateTemporaryMeasure</a></li><li data-type='method'><a href="TApplication.html#updateViewportSizes">updateViewportSizes</a></li></ul></li><li><a href="TCache.html">TCache</a><ul class='methods'><li data-type='method'><a href="TCache.html#add">add</a></li><li data-type='method'><a href="TCache.html#clear">clear</a></li><li data-type='method'><a href="TCache.html#get">get</a></li><li data-type='method'><a href="TCache.html#remove">remove</a></li></ul></li><li><a href="TDataBaseManager.html">TDataBaseManager</a><ul class='methods'><li data-type='method'><a href="TDataBaseManager.html#._statusOk">_statusOk</a></li><li data-type='method'><a href="TDataBaseManager.html#.requestServer">requestServer</a></li><li data-type='method'><a href="TDataBaseManager.html#_create">_create</a></li><li data-type='method'><a href="TDataBaseManager.html#_deleteOne">_deleteOne</a></li><li data-type='method'><a href="TDataBaseManager.html#_deleteSome">_deleteSome</a></li><li data-type='method'><a href="TDataBaseManager.html#_onArrayBuffer">_onArrayBuffer</a></li><li data-type='method'><a href="TDataBaseManager.html#_onBlob">_onBlob</a></li><li data-type='method'><a href="TDataBaseManager.html#_onError">_onError</a></li><li data-type='method'><a href="TDataBaseManager.html#_onJson">_onJson</a></li><li data-type='method'><a href="TDataBaseManager.html#_onLoad">_onLoad</a></li><li data-type='method'><a href="TDataBaseManager.html#_onProgress">_onProgress</a></li><li data-type='method'><a href="TDataBaseManager.html#_onText">_onText</a></li><li data-type='method'><a href="TDataBaseManager.html#_readOne">_readOne</a></li><li data-type='method'><a href="TDataBaseManager.html#_readSome">_readSome</a></li><li data-type='method'><a href="TDataBaseManager.html#_updateOne">_updateOne</a></li><li data-type='method'><a href="TDataBaseManager.html#_updateSome">_updateSome</a></li><li data-type='method'><a href="TDataBaseManager.html#create">create</a></li><li data-type='method'><a href="TDataBaseManager.html#delete">delete</a></li><li data-type='method'><a href="TDataBaseManager.html#read">read</a></li><li data-type='method'><a href="TDataBaseManager.html#update">update</a></li></ul></li><li><a href="TErrorManager.html">TErrorManager</a></li><li><a href="TFactory.html">TFactory</a></li><li><a href="TGeometriesManager.html">TGeometriesManager</a><ul class='methods'><li data-type='method'><a href="TGeometriesManager.html#convertJsonToGeometry">convertJsonToGeometry</a></li></ul></li><li><a href="TMaterialsManager.html">TMaterialsManager</a></li><li><a href="TObjectsManager.html">TObjectsManager</a></li><li><a href="TOrbitControlsHelper.html">TOrbitControlsHelper</a></li><li><a href="TOrchestrator.html">TOrchestrator</a><ul class='methods'><li data-type='method'><a href="TOrchestrator.html#processQueue">processQueue</a></li><li data-type='method'><a href="TOrchestrator.html#queue">queue</a></li></ul></li><li><a href="TPointsManager.html">TPointsManager</a></li><li><a href="TProgressManager.html">TProgressManager</a></li><li><a href="TScenesManager.html">TScenesManager</a></li><li><a href="TUniversalLoader.html">TUniversalLoader</a></li><li><a href="TViewport.html">TViewport</a></li></ul><h3>Modules</h3><ul><li><a href="module-config_babelConfiguration.html">config/babelConfiguration</a><ul class='methods'><li data-type='method'><a href="module-config_babelConfiguration.html#~CreateBabelConfiguration">CreateBabelConfiguration</a></li></ul></li><li><a href="module-config_eslintConfiguration.html">config/eslintConfiguration</a><ul class='methods'><li data-type='method'><a href="module-config_eslintConfiguration.html#~CreateEslintConfiguration">CreateEslintConfiguration</a></li></ul></li><li><a href="module-config_jsdocConfiguration.html">config/jsdocConfiguration</a><ul class='methods'><li data-type='method'><a href="module-config_jsdocConfiguration.html#~CreateJsdocConfiguration">CreateJsdocConfiguration</a></li></ul></li><li><a href="module-config_karmaBenchConfiguration.html">config/karmaBenchConfiguration</a><ul class='methods'><li data-type='method'><a href="module-config_karmaBenchConfiguration.html#~CreateKarmaBenchmarkConfiguration">CreateKarmaBenchmarkConfiguration</a></li></ul></li><li><a href="module-config_karmaUnitConfiguration.html">config/karmaUnitConfiguration</a><ul class='methods'><li data-type='method'><a href="module-config_karmaUnitConfiguration.html#~CreateKarmaUnitTestingConfiguration">CreateKarmaUnitTestingConfiguration</a></li></ul></li><li><a href="module-config_rollupConfiguration.html">config/rollupConfiguration</a><ul class='methods'><li data-type='method'><a href="module-config_rollupConfiguration.html#~CreateRollupConfiguration">CreateRollupConfiguration</a></li></ul></li><li><a href="module-gulpfile.html">gulpfile</a><ul class='methods'><li data-type='method'><a href="module-gulpfile.html#~gulp_convert-anaglyph-effect-to-es6-module">gulp _convert-anaglyph-effect-to-es6-module</a></li><li data-type='method'><a href="module-gulpfile.html#~gulp_convert-detector-to-es6-module">gulp _convert-detector-to-es6-module</a></li><li data-type='method'><a href="module-gulpfile.html#~gulp_convert-orbit-controls-to-es6-module">gulp _convert-orbit-controls-to-es6-module</a></li><li data-type='method'><a href="module-gulpfile.html#~gulp_convert-stereo-effect-to-es6-module">gulp _convert-stereo-effect-to-es6-module</a></li><li data-type='method'><a href="module-gulpfile.html#~gulp_extendThree">gulp _extendThree</a></li><li data-type='method'><a href="module-gulpfile.html#~npmrunbench">npm run bench</a></li><li data-type='method'><a href="module-gulpfile.html#~npmrunbuild">npm run build</a></li><li data-type='method'><a href="module-gulpfile.html#~npmrunclean">npm run clean</a></li><li data-type='method'><a href="module-gulpfile.html#~npmrundoc">npm run doc</a></li><li data-type='method'><a href="module-gulpfile.html#~npmrunlint">npm run lint</a></li><li data-type='method'><a href="module-gulpfile.html#~npmrunrelease">npm run release</a></li><li data-type='method'><a href="module-gulpfile.html#~npmruntest">npm run test</a></li><li data-type='method'><a href="module-gulpfile.html#~npmrununit">npm run unit</a></li><li data-type='method'><a href="module-gulpfile.html#~npmrunhelpdefault">npm run help </a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#addPointsFromBuffer">addPointsFromBuffer</a></li><li><a href="global.html#endianness">endianness</a></li><li><a href="global.html#getPointClouds">getPointClouds</a></li><li><a href="global.html#getSamplingForDistanceToCamera">getSamplingForDistanceToCamera</a></li><li><a href="global.html#HttpStatusCode">HttpStatusCode</a></li><li><a href="global.html#HttpVerb">HttpVerb</a></li><li><a href="global.html#ResponseType">ResponseType</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">sources/loaders/TUniversalLoader.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * @class TUniversalLoader
 * @classdesc The TUniversalLoader allow to automatically select correct THREE loader for given files. (based on https://github.com/jeromeetienne/threex.universalloader)
 * @example Todo...
 *
 */

/* eslint-env browser */

import { Mesh } from '../../node_modules/three/src/objects/Mesh'
import { MeshPhongMaterial } from '../../node_modules/three/src/materials/MeshPhongMaterial'
//import { STLLoader } from '../../builds/tmp/STLLoader'
//import { OBJLoader } from '../../builds/tmp/OBJLoader'
//import { FBXLoader2 } from '../../builds/tmp/FBXLoader2'
//import { MTLLoader } from '../../builds/tmp/MTLLoader'
//
//import { ASCLoader } from '../../javascript/webgl/ASCLoader'

function onError ( error ) {
    console.error( error )
}

function onProgress ( progressEvent ) {

    if ( progressEvent.lengthComputable ) {

        var percentComplete = progressEvent.loaded / progressEvent.total * 100
        console.log( Math.round( percentComplete ) + '% downloaded' )

    }
}

function TUniversalLoader () {

//    this.stlLoader = new STLLoader()
//    this.ascLoader = new ASCLoader()
//    this.fbxLoader = new FBXLoader2()
//    this.objLoader = new OBJLoader()
//    this.mtlLoader = new MTLLoader()

    this.stlLoader = {}
    this.ascLoader = {}
    this.fbxLoader = {}
    this.objLoader = {}
    this.mtlLoader = {}

}

Object.assign( TUniversalLoader.prototype, {

    load: function ( urls, onLoad, fromBlob, params ) {

        console.log( "TUniversalLoader.load" )
        if ( !urls ) {
            console.error( "Unable to load null or undefined urls !" );
            return
        }

        var _fromBlob       = (typeof (fromBlob) === 'boolean') ? fromBlob : false
        var urlsConstructor = urls.constructor;

        if ( urlsConstructor === String ) {

            this.loadSingleFile( urls, onLoad, _fromBlob, params )

        } else if ( urlsConstructor === Array ) {

            if ( (urls.length === 2) &amp;&amp; (urls[ 0 ].constructor === String) ) {
                this.loadAssociatedFiles( urls, onLoad, _fromBlob, params )
            } else {

                var url              = undefined
                var childConstructor = undefined
                for ( var i = 0, numberOfUrls = urls.length ; i &lt; numberOfUrls ; i++ ) {

                    url              = urls[ i ]
                    childConstructor = url.constructor

                    if ( childConstructor === Array ) {

                        this.loadAssociatedFiles( url, onLoad, _fromBlob, params )

                    } else if ( childConstructor === String ) {

                        this.loadSingleFile( url, onLoad, _fromBlob, params )

                    } else {

                        console.error( 'Invalid child url' )

                    }

                }

            }

        } else if ( urlsConstructor === Function ) {

            var _urls = urls()
            this.load( _urls, onLoad, fromBlob, params )

        } else {

            console.error( 'Invalid url' )

        }

    },

    loadSingleFile: function ( url, onLoad, fromBlob, params ) {

        var filePath = url.substring( 0, url.lastIndexOf( '/' ) )
        var fileName = url.substring( url.lastIndexOf( '/' ) + 1 )
        var loadUrl  = (fromBlob) ? filePath : url

        if ( fileName.match( /\.stl$/i ) ) {

            this.stlLoader.load(
                loadUrl,
                function ( geometry ) {

                    var material = new MeshPhongMaterial()
                    var object3d = new Mesh( geometry, material )
                    onLoad( object3d )

                },
                onProgress,
                onError
            )

        } else if ( fileName.match( /\.rzml/i ) ) {

            this.rzmlLoader.load(
                loadUrl,
                onLoad,
                onProgress,
                onError
            )

        } else if ( fileName.match( /\.asc$/i ) ) {

            this.ascLoader.load(
                loadUrl,
                onLoad,
                onProgress,
                onError,
                params
            )

        } else if ( fileName.match( /\.fbx$/i ) ) {

            this.fbxLoader.load(
                loadUrl,
                onLoad,
                onProgress,
                onError
            )

        } else if ( fileName.match( /\.obj$/i ) ) {

            this.objLoader.load(
                loadUrl,
                onLoad,
                onProgress,
                onError
            )

        } else {

            console.error( 'Unknown file type:' + fileName )

        }

    },

    // Todo: need to break texture resolution dependency and conert as params
    loadAssociatedFiles: function ( urls, onLoad, fromBlob, textureResolution ) {

        var TEXTURE_RESOLUTION = (textureResolution) ? textureResolution : "256"

        var firstUrl      = urls[ 0 ]
        var firstFilePath = firstUrl.substring( 0, firstUrl.lastIndexOf( '/' ) )
        var firstFileName = firstUrl.substring( firstUrl.lastIndexOf( '/' ) + 1 )
        var firstLoadUrl  = (fromBlob) ? firstFilePath : firstUrl

        var secondUrl      = urls[ 1 ]
        var secondFilePath = secondUrl.substring( 0, secondUrl.lastIndexOf( '/' ) )
        var secondFileName = secondUrl.substring( secondUrl.lastIndexOf( '/' ) + 1 )
        var secondLoadUrl  = (fromBlob) ? secondFilePath : secondUrl

        if ( firstFileName.match( /\.mtl$/i ) &amp;&amp; secondFileName.match( /\.obj$/i ) ) {

            var mtlLoader = new MTLLoader()
            var objLoader = new OBJLoader()
            mtlLoader.setTexturePath( firstFilePath + '/textures/' + TEXTURE_RESOLUTION + '/' )
            mtlLoader.load( firstLoadUrl, function ( materials ) {
                materials.preload()

                objLoader.setMaterials( materials )
                objLoader.load( secondLoadUrl, function ( object3d ) {
                    onLoad( object3d )
                } )
            }.bind( this ) )

        } else if ( firstFileName.match( /\.obj$/i ) &amp;&amp; secondFileName.match( /\.mtl$/i ) ) {

            var mtlLoader = new MTLLoader()
            var objLoader = new OBJLoader()
            mtlLoader.setTexturePath( secondFilePath + '/textures/' + TEXTURE_RESOLUTION + '/' )
            mtlLoader.load( secondLoadUrl, function ( materials ) {

                materials.preload()

                objLoader.setMaterials( materials )
                objLoader.load( firstLoadUrl, function ( object3d ) {

                    onLoad( object3d )

                } )

            }.bind( this ) )

        } else {

            this.loadSingleFile( urls[ 0 ], onLoad, fromBlob, params )
            this.loadSingleFile( urls[ 1 ], onLoad, fromBlob, params )
            console.error( 'Unknown file type' )

        }

    }

} )

export { TUniversalLoader }
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
